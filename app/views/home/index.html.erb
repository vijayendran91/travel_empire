<%= render :partial => 'home/navbar_files/navbar'%>
<center>
  <div id="formContainer" class="shadow-lg p-3 mb-5 bg-white rounded">

    <div id="initBtnCntnr">
      <div class="form-row mt-4">
        <div class="form-group col-md-6">
          <button type="button" id="bookCab" name="button" class="btn green-btn ">Book a Cab</button>
        </div>
        <div class="form-group col-md-6">
          <%= link_to "Make a Payment", "https://pmny.in/aIlQzaGFxaIb",:id => "makePayment", :class=> "btn green-btn"%>
        </div>
      </div>
    </div>
    <%=render :partial => 'home/cab_booking/tot_modal.html.erb'%>
    <%=@trip.fname%>
    <%= form_for(@trip,:as => 'trip', url: submit_trip_path(@trip)) do |f| %>
      <%=render :partial => 'home/cab_booking/per_bus', :locals => {:f => f}%>
      <%=render :partial => 'home/cab_booking/cab_booking_form', :locals => {:f => f}%>
      <%=f.submit "Book Ride", :class=>"btn ml-3 green-btn form-submit"%>
    <%end%>
  </div>
</center>
<script type="text/javascript" src="data/data.json"></script>
<script>
  let porb = "";
  let tor = "";
  let locs = 0;
  let json_data = JSON.stringify(data);
  let modal_texts = JSON.parse(json_data)["modaltexts"];
  let  districts_data = JSON.parse(json_data)["districts"];
  $(document).ready(function(){
    $('#totModal').hide();
    $('.perOrBus').hide();
    $('#addLocation').hide();
    $('#bookCab').on('click', function(){
        $('#bookCab').hide();
        $('#makePayment').hide();
        $('.perOrBus').show();
      // $('.cabBookingForm').show();
    });

    $('#personalRadio').on('click',function(){
      $('#gst').hide();
      $('#gstLabel').hide();
      $('.cabBookingForm').show();
    });

    $('#businessRadio').on('click',function(){
      $('#gst').show();
      $('#gstLabel').show();
      $('.cabBookingForm').show();
    });

    function showModal(tor){
      $('#totModal').on('show.bs.modal', function(event){
        var modal = $(this);
        var list_string = "<ul>";
        console.log(tor);
        modal.find('.modal-title').text(modal_texts[tor]['title']);
        for(item in modal_texts[tor]){
        if(item != "title"){
            if(item == 'red'){
                list_string += "<li class='modal-list-red'>"+modal_texts[tor][item]+"</li>"  
              }
              else{
                list_string += "<li>"+modal_texts[tor][item]+"</li>"
              }
          }
        }
        list_string+="</ul>"
        modal.find('.modal-body-text').html(list_string);
        modal.find('.modal-body-image').html("<img src='/assets/"+tor+".png' class='modal-image'/>")
      });
      $('#totModal').modal('show'); 
    }


    $( "#inlineFormCustomSelect" ).change(function() {
      tor =  $(this).val();
      console.log(tor+" 1");
      switch(tor){
          case "ow":
              showModal(tor);
              $('#addLocation').hide();
              $('#toDistSelect').show();
              $('#locationSwap').show();
              $('#toAreaLabel').show();
              $('#toDistLabel').show();
              $('#toArea').show();
              $('.locations').hide();
              $('#totModal').show();
              break;
          case "rtt":
              showModal(tor);
              $('#addLocation').hide();
              $('#toDistSelect').show();
              $('#toAreaLabel').show();
              $('#locationSwap').show();
              $('.locations').hide();
              $('#toDistLabel').show();
              $('#toArea').show();
              break;
          case "rt":
              showModal(tor);
              $('.locations').show();
              $('#addLocation').show();
              $('#locationSwap').hide();
              $('#toDistSelect').hide();
              $('#toDistLabel').hide();
              $('#toAreaLabel').hide();
              $('#toArea').hide();
              break;
          case "my":
              showModal(tor);
              $('.locations').show();
              $('#addLocation').show();
              $('#locationSwap').hide();
              $('#toDistSelect').hide();
              $('#toAreaLabel').hide();
              $('#toDistLabel').hide();
              $('#toArea').hide();
              break;
          case "hy":
              showModal(tor);
              $('.locations').hide();
              $('#addLocation').hide();
              $('#locationSwap').hide();
              $('#toDistSelect').hide();
              $('#toAreaLabel').hide();
              $('#toDistLabel').hide();
              $('#toArea').hide();
              break;
        location.reload();
      }
    });

    $('#addLocation').on('click',function(){
      locs++;
      if(locs<5){
        parElem = document.getElementById('multiLocations');
        input = document.createElement("input");
        input.setAttribute('type','text');
        input.setAttribute('class',"form-control mb-3 locations");
        parElem.appendChild(input);
      }else{
        window.alert("You can add only maximum of 4 locations");
      }
    });

    for(let i=0; i<districts_data.length;i++){
      $("#fromDistSelect").append('<option value="'+districts_data[i]+'">' + districts_data[i] + '</option>');
      $("#toDistSelect").append('<option value="'+districts_data[i]+'">' + districts_data[i] + '</option>');
    }

  });
</script>
